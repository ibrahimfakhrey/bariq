{% extends "admin/layout.html" %}

{% block title %}Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡{% endblock %}

{% block page_content %}
<div id="customers-content">
    <div class="loading-container">
        <div class="spinner"></div>
    </div>
</div>

<!-- Customer Detail Modal -->
<div id="customerModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3 id="modalTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
            <button onclick="closeModal()" class="btn btn-sm btn-secondary">&times;</button>
        </div>
        <div id="modalBody" class="modal-body">
            <!-- Content loaded dynamically -->
        </div>
    </div>
</div>

<!-- Credit Adjustment Modal -->
<div id="creditModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯</h3>
            <button onclick="closeCreditModal()" class="btn btn-sm btn-secondary">&times;</button>
        </div>
        <div class="modal-body">
            <form id="creditForm" onsubmit="submitCreditAdjustment(event)">
                <input type="hidden" id="creditCustomerId">
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                    <select id="creditType" class="form-control" required onchange="updateCreditLabel()">
                        <option value="add">Ø§Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯</option>
                        <option value="remove">Ø®ØµÙ… Ø±ØµÙŠØ¯</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="amountLabel">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¶Ø§Ù</label>
                    <input type="number" id="creditAmount" class="form-control" min="1" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø³Ø¨Ø¨</label>
                    <select id="creditReason" class="form-control" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¨Ø¨</option>
                        <option value="promotional_bonus">Ù…ÙƒØ§ÙØ£Ø© ØªØ±ÙˆÙŠØ¬ÙŠØ©</option>
                        <option value="error_correction">ØªØµØ­ÙŠØ­ Ø®Ø·Ø£</option>
                        <option value="customer_service">Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>
                        <option value="refund">Ø§Ø³ØªØ±Ø¯Ø§Ø¯</option>
                        <option value="penalty">Ø®ØµÙ… Ø¬Ø²Ø§Ø¦ÙŠ</option>
                        <option value="fraud_adjustment">ØªØ¹Ø¯ÙŠÙ„ Ø§Ø­ØªÙŠØ§Ù„</option>
                        <option value="other">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <textarea id="creditNotes" class="form-control" rows="2"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" onclick="closeCreditModal()" class="btn btn-secondary">Ø§Ù„ØºØ§Ø¡</button>
                    <button type="submit" class="btn btn-primary">ØªÙ†ÙÙŠØ°</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}
.modal-content {
    background: white;
    border-radius: 0.75rem;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--gray-200);
}
.modal-header h3 {
    margin: 0;
    font-size: 1.125rem;
}
.modal-body {
    padding: 1.5rem;
}
.form-group {
    margin-bottom: 1rem;
}
.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--gray-700);
}
.form-control {
    width: 100%;
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--gray-300);
    border-radius: 0.375rem;
    font-size: 0.875rem;
}
.form-control:focus {
    outline: none;
    border-color: var(--teal-500);
    box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
}
</style>
{% endblock %}

{% block extra_js %}
{{ super() }}
<script>
    let currentCustomers = [];
    let currentPage = 1;
    let currentFilters = {};

    async function loadCustomers(page = 1, filters = {}) {
        const container = document.getElementById('customers-content');
        currentPage = page;
        currentFilters = filters;

        try {
            const params = { page, per_page: 20, ...filters };
            const result = await API.admin.getCustomers(params);

            if (!result.success) {
                showError(container, result.data?.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡');
                return;
            }

            currentCustomers = result.data?.data?.customers || [];
            const pagination = result.data?.data?.pagination || {};

            container.innerHTML = `
                <!-- Page Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h1 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.25rem;">
                            Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                        </h1>
                        <p style="color: var(--gray-500);">Ø§Ø¬Ù…Ø§Ù„ÙŠ ${pagination.total || 0} Ø¹Ù…ÙŠÙ„</p>
                    </div>
                    <button onclick="exportCustomers()" class="btn btn-secondary">
                        ğŸ“¥ ØªØµØ¯ÙŠØ± Excel
                    </button>
                </div>

                <!-- Filters -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end;">
                        <div style="flex: 1; min-width: 200px;">
                            <label style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">Ø¨Ø­Ø«</label>
                            <input type="text" id="searchInput" placeholder="Ø§Ø³Ù…ØŒ Ù‡Ø§ØªÙØŒ Ø±Ù‚Ù… Ø¨Ø±ÙŠÙ‚..."
                                   class="form-control" value="${filters.search || ''}"
                                   onkeyup="if(event.key === 'Enter') applyFilters()">
                        </div>
                        <div style="min-width: 150px;">
                            <label style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <select id="statusFilter" class="form-control" onchange="applyFilters()">
                                <option value="">Ø§Ù„ÙƒÙ„</option>
                                <option value="active" ${filters.status === 'active' ? 'selected' : ''}>Ù†Ø´Ø·</option>
                                <option value="pending" ${filters.status === 'pending' ? 'selected' : ''}>Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„</option>
                                <option value="suspended" ${filters.status === 'suspended' ? 'selected' : ''}>Ù…ÙˆÙ‚ÙˆÙ</option>
                                <option value="blocked" ${filters.status === 'blocked' ? 'selected' : ''}>Ù…Ø­Ø¸ÙˆØ±</option>
                            </select>
                        </div>
                        <div style="min-width: 150px;">
                            <label style="display: block; margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                            <select id="cityFilter" class="form-control" onchange="applyFilters()">
                                <option value="">Ø§Ù„ÙƒÙ„</option>
                                <option value="Ø§Ù„Ø±ÙŠØ§Ø¶" ${filters.city === 'Ø§Ù„Ø±ÙŠØ§Ø¶' ? 'selected' : ''}>Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                                <option value="Ø¬Ø¯Ø©" ${filters.city === 'Ø¬Ø¯Ø©' ? 'selected' : ''}>Ø¬Ø¯Ø©</option>
                                <option value="Ù…ÙƒØ©" ${filters.city === 'Ù…ÙƒØ©' ? 'selected' : ''}>Ù…ÙƒØ©</option>
                                <option value="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" ${filters.city === 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©' ? 'selected' : ''}>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                            </select>
                        </div>
                        <button onclick="applyFilters()" class="btn btn-primary">
                            Ø¨Ø­Ø«
                        </button>
                        <button onclick="clearFilters()" class="btn btn-secondary">
                            Ù…Ø³Ø­
                        </button>
                    </div>
                </div>

                <!-- Customers Table -->
                <div class="card">
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø¨Ø±ÙŠÙ‚</th>
                                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                                    <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                    <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                                    <th>Ø­Ø¯ Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†</th>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø§Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${currentCustomers.map(c => `
                                    <tr>
                                        <td style="font-family: monospace; font-weight: 600;">${c.bariq_id || '-'}</td>
                                        <td>${c.full_name_ar || c.full_name_en || '-'}</td>
                                        <td dir="ltr">${c.phone || '-'}</td>
                                        <td>${c.city || '-'}</td>
                                        <td>${formatCurrency(c.credit_limit)}</td>
                                        <td>
                                            <span style="color: ${c.used_credit > 0 ? 'var(--rose-600)' : 'var(--gray-500)'}">
                                                ${formatCurrency(c.used_credit)}
                                            </span>
                                        </td>
                                        <td><span class="badge ${getStatusBadgeClass(c.status)}">${getStatusLabel(c.status)}</span></td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button onclick="viewCustomer('${c.id}')" class="btn btn-sm btn-secondary" title="Ø¹Ø±Ø¶">
                                                    ğŸ‘ï¸
                                                </button>
                                                <button onclick="openCreditModal('${c.id}')" class="btn btn-sm btn-primary" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯">
                                                    ğŸ’°
                                                </button>
                                                ${c.status === 'active' ? `
                                                    <button onclick="suspendCustomer('${c.id}')" class="btn btn-sm" style="background: var(--amber-500); color: white;" title="Ø§ÙŠÙ‚Ø§Ù">
                                                        â¸ï¸
                                                    </button>
                                                ` : c.status === 'suspended' ? `
                                                    <button onclick="activateCustomer('${c.id}')" class="btn btn-sm" style="background: var(--emerald-500); color: white;" title="ØªÙØ¹ÙŠÙ„">
                                                        â–¶ï¸
                                                    </button>
                                                ` : ''}
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                                ${currentCustomers.length === 0 ? `
                                    <tr>
                                        <td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬
                                        </td>
                                    </tr>
                                ` : ''}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    ${pagination.pages > 1 ? `
                        <div style="display: flex; justify-content: center; gap: 0.5rem; padding: 1rem; border-top: 1px solid var(--gray-200);">
                            ${currentPage > 1 ? `
                                <button onclick="loadCustomers(${currentPage - 1}, currentFilters)" class="btn btn-sm btn-secondary">
                                    Ø§Ù„Ø³Ø§Ø¨Ù‚
                                </button>
                            ` : ''}
                            <span style="padding: 0.5rem 1rem; color: var(--gray-600);">
                                ØµÙØ­Ø© ${currentPage} Ù…Ù† ${pagination.pages}
                            </span>
                            ${currentPage < pagination.pages ? `
                                <button onclick="loadCustomers(${currentPage + 1}, currentFilters)" class="btn btn-sm btn-secondary">
                                    Ø§Ù„ØªØ§Ù„ÙŠ
                                </button>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
            `;

        } catch (error) {
            console.error('Load customers error:', error);
            showError(container, 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡');
        }
    }

    function applyFilters() {
        const filters = {
            search: document.getElementById('searchInput')?.value || '',
            status: document.getElementById('statusFilter')?.value || '',
            city: document.getElementById('cityFilter')?.value || ''
        };
        // Remove empty filters
        Object.keys(filters).forEach(k => !filters[k] && delete filters[k]);
        loadCustomers(1, filters);
    }

    function clearFilters() {
        loadCustomers(1, {});
    }

    async function viewCustomer(id) {
        const modal = document.getElementById('customerModal');
        const modalBody = document.getElementById('modalBody');
        const modalTitle = document.getElementById('modalTitle');

        modal.style.display = 'flex';
        modalBody.innerHTML = '<div class="loading-container"><div class="spinner"></div></div>';

        try {
            const result = await API.admin.getCustomer(id);
            if (!result.success) {
                modalBody.innerHTML = '<div class="alert alert-error">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>';
                return;
            }

            const c = result.data?.data || {};
            modalTitle.textContent = c.full_name_ar || c.full_name_en || 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„';

            modalBody.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label style="color: var(--gray-500); font-size: 0.75rem;">Ø±Ù‚Ù… Ø¨Ø±ÙŠÙ‚</label>
                        <div style="font-weight: 600; font-size: 1.25rem; font-family: monospace;">${c.bariq_id || '-'}</div>
                    </div>
                    <div>
                        <label style="color: var(--gray-500); font-size: 0.75rem;">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <div><span class="badge ${getStatusBadgeClass(c.status)}">${getStatusLabel(c.status)}</span></div>
                    </div>
                    <div>
                        <label style="color: var(--gray-500); font-size: 0.75rem;">Ø§Ù„Ø§Ø³Ù…</label>
                        <div>${c.full_name_ar || '-'}</div>
                    </div>
                    <div>
                        <label style="color: var(--gray-500); font-size: 0.75rem;">Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <div dir="ltr">${c.phone || '-'}</div>
                    </div>
                    <div>
                        <label style="color: var(--gray-500); font-size: 0.75rem;">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <div>${c.email || '-'}</div>
                    </div>
                    <div>
                        <label style="color: var(--gray-500); font-size: 0.75rem;">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                        <div>${c.national_id || '-'}</div>
                    </div>
                    <div>
                        <label style="color: var(--gray-500); font-size: 0.75rem;">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                        <div>${c.city || '-'}</div>
                    </div>
                    <div>
                        <label style="color: var(--gray-500); font-size: 0.75rem;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</label>
                        <div>${formatDate(c.created_at)}</div>
                    </div>
                </div>

                <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid var(--gray-200);">

                <h4 style="margin-bottom: 1rem;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="stat-card stat-card-teal" style="padding: 1rem;">
                        <div style="color: var(--gray-600); font-size: 0.75rem;">Ø­Ø¯ Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†</div>
                        <div style="font-size: 1.25rem; font-weight: 700;">${formatCurrency(c.credit_limit)}</div>
                    </div>
                    <div class="stat-card stat-card-emerald" style="padding: 1rem;">
                        <div style="color: var(--gray-600); font-size: 0.75rem;">Ø§Ù„Ù…ØªØ§Ø­</div>
                        <div style="font-size: 1.25rem; font-weight: 700;">${formatCurrency(c.available_credit)}</div>
                    </div>
                    <div class="stat-card stat-card-rose" style="padding: 1rem;">
                        <div style="color: var(--gray-600); font-size: 0.75rem;">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
                        <div style="font-size: 1.25rem; font-weight: 700;">${formatCurrency(c.used_credit)}</div>
                    </div>
                </div>

                <div style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: flex-end;">
                    <button onclick="openCreditModal('${c.id}'); closeModal();" class="btn btn-primary">
                        ğŸ’° ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯
                    </button>
                    <button onclick="closeModal()" class="btn btn-secondary">Ø§ØºÙ„Ø§Ù‚</button>
                </div>
            `;

        } catch (error) {
            modalBody.innerHTML = '<div class="alert alert-error">Ø­Ø¯Ø« Ø®Ø·Ø£</div>';
        }
    }

    function closeModal() {
        document.getElementById('customerModal').style.display = 'none';
    }

    function openCreditModal(customerId) {
        document.getElementById('creditCustomerId').value = customerId;
        document.getElementById('creditForm').reset();
        document.getElementById('creditModal').style.display = 'flex';
        updateCreditLabel();
    }

    function closeCreditModal() {
        document.getElementById('creditModal').style.display = 'none';
    }

    function updateCreditLabel() {
        const type = document.getElementById('creditType').value;
        document.getElementById('amountLabel').textContent = type === 'add' ? 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¶Ø§Ù' : 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø®ØµÙˆÙ…';
    }

    async function submitCreditAdjustment(event) {
        event.preventDefault();

        const customerId = document.getElementById('creditCustomerId').value;
        const type = document.getElementById('creditType').value;
        let amount = parseFloat(document.getElementById('creditAmount').value);
        const reason = document.getElementById('creditReason').value;
        const notes = document.getElementById('creditNotes').value;

        if (type === 'remove') {
            amount = -amount;
        }

        try {
            const result = await API.admin.adjustCustomerCredit(customerId, amount, reason, notes);
            if (result.success) {
                alert('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­');
                closeCreditModal();
                loadCustomers(currentPage, currentFilters);
            } else {
                alert(result.data?.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
            }
        } catch (error) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯');
        }
    }

    async function suspendCustomer(id) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§ÙŠÙ‚Ø§Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) return;

        try {
            const result = await API.admin.updateCustomer(id, { status: 'suspended' });
            if (result.success) {
                alert('ØªÙ… Ø§ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…ÙŠÙ„');
                loadCustomers(currentPage, currentFilters);
            } else {
                alert(result.data?.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
            }
        } catch (error) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£');
        }
    }

    async function activateCustomer(id) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) return;

        try {
            const result = await API.admin.updateCustomer(id, { status: 'active' });
            if (result.success) {
                alert('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„');
                loadCustomers(currentPage, currentFilters);
            } else {
                alert(result.data?.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£');
            }
        } catch (error) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£');
        }
    }

    function exportCustomers() {
        if (currentCustomers.length === 0) {
            alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
            return;
        }

        const exportData = currentCustomers.map(c => ({
            'Ø±Ù‚Ù… Ø¨Ø±ÙŠÙ‚': c.bariq_id,
            'Ø§Ù„Ø§Ø³Ù…': c.full_name_ar || c.full_name_en,
            'Ø§Ù„Ù‡Ø§ØªÙ': c.phone,
            'Ø§Ù„Ø¨Ø±ÙŠØ¯': c.email,
            'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©': c.city,
            'Ø­Ø¯ Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†': c.credit_limit,
            'Ø§Ù„Ù…ØªØ§Ø­': c.available_credit,
            'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': c.used_credit,
            'Ø§Ù„Ø­Ø§Ù„Ø©': getStatusLabel(c.status),
            'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„': formatDate(c.created_at)
        }));

        exportToExcel(exportData, 'customers');
    }

    // Load on page ready
    document.addEventListener('DOMContentLoaded', () => loadCustomers());
</script>
{% endblock %}
